# 📌 分页查询

## 📄 罗列场景

### 🔖 用户操作日志查询系统

**业务场景：**

- 目标用户：系统管理员或安全审计人员。
- 功能需求：允许用户查询系统内所有用户的操作记录，包括登录、登出、修改密码等。支持按时间范围、用户名筛选并进行分页展示。

**关键特性：**

- 维护变化性：低，字段和逻辑稳定。
- 数据量：中到大，取决于系统的使用频率和年限。
- 一致性要求：低，可以接受几秒内的延迟。

### 🔖 电商平台商品搜索

**业务场景：**

- 目标用户：普通消费者。
- 功能需求：提供商品搜索服务，支持按关键词、价格区间、品牌、评分等多种条件过滤，并支持分页显示搜索结果。

**关键特性：**

- 简明通用：中，虽然“商品搜索”很普遍，但具体实现细节差异较大。
- 维护变化性：高，随着市场策略调整，排序规则和过滤条件可能频繁变动。
- 数据量：非常大，特别是对于大型电商平台而言。
- 一致性要求：中低，用户对最新的商品上架信息有一定的容忍度。

### 🔖 **金融交易系统的对账明细查询**

**业务背景**

- 目标用户：财务部门员工。
- 功能需求：提供每日/每月交易流水查询服务，确保每一笔交易都被准确记录，并能够按账户、日期范围等条件进行精确查找与核对。

**关键特性**

- 维护变化性：极低，一旦上线后改动较少。
- 数据量：极大，长期积累的数据量庞大。
- 一致性要求：极高，不允许有任何错误或遗漏。

### 🔖 社交应用的消息会话列表

**业务背景**

- 目标用户：社交软件用户。
- 功能需求：展示用户的所有聊天会话，按照最近一次消息的时间降序排列，支持加载更多历史消息。

**关键特性**

- 维护变化性：中，可能会根据用户体验调整界面布局或增加新功能。
- 数据量：单用户相对较小，但总体数量可观。
- 一致性要求：中高，用户期望看到最新的消息状态。

## 📄 结构拆解

一个分页查询构成

1. 输入：

```json
{
  // where 类条件
  filter condition....
  
  // 排序条件
  sort condigtion
  
  // 分页条件
  page condition
}
```

2. 查询方式：

- limit offset
- 游码查询

3. 输出：

```json
{
  page info
  data info
}
```

## 📄 优雅入参

基于以下前提：

1. 表新增字段，查询逻辑变更时总要改大批量的代码
2. 不同的端使用端尤其最优实践，需要衡量兼顾

### 🔖 排序条件输入

---

**前端：用户交互层**

```json
{
  sorts: [{
    targetName: "",
    sortType: ""
  }]
}
```

----

**后端：逻辑处理层**

1. 识别目标字段 + 排序方式
2. 基本合法性、安全性校验
3. 构造 SQL

----

**DB：数据管理层**

执行 SQL：

```Mysql
Select * from target_table where ...
order by 
targetName_ sortType_,
...
...
```

${\large {\color[RGB]{250, 157, 30}分类点}} $

1. **targetName = targetName_，即输入字段名和表中字段名严格对应**

**优点：**

- 不需要做映射。逻辑处理层的目标字段识别工作的复杂度较低

- 后续大量增加字段字段枚举类维护即可，不需要修改代码逻辑。
- 自明性

**缺点：**

- 表变迁修改字段，需要引入代码映射逻辑，自明性破坏且造成误解

---

2. **对输入 targetName 做码值抽象**

**优点：**

- 架构稳定，可以适应结构变迁

**缺点：**

- 多做一层映射

---

3. sortType的定义域为 ASC、DESC

- ASC、DESC两个值类型有限，也已经作为成为经典的排序方式表达的词组。其表达能力和其它形式的同等或更优。因此直接传这两个即可

## 📄 效率分析

分页查询效率瓶颈分析以及优化：
[limit offset.md](../../数据存储/MySQL/limit offset.md) 

## 🌳 生长思考

对发散的自由捕捉、精确化

## 💭 反复绊脚

记录回顾、使用文档时，遇到的困惑



## 🗺️ 修订记录

重要修订记录

## 🛠️ 实践经历

记录实践经历： demo + 工作经历 + 第三方优秀经验反思



## ⚙️ prompt

探究该文档模块过程中的 prompt 记录
模版如下：

```markdown
# 背景
我是一名追求效率的学习者。我从事于Java后端开发工程师的工作。
我认为学习本质上就是 大量正确信息的消化 + 关键结论的感受 + 自由的发散。
依托这样的思想，我希望和你来进行一场talk。

我们的 talk 基于以下原则
1. 你是 该talk 主题下的专家
2. 我是一名在其他领域具有通用性技能的工程师，如 Java、传统算法、后端工程、C++ 语法、Go 语法等。拥有一定计算机基础的知识。
3. 我们是不同领域的擅长者，这是一场圆桌会议式的talk。就和索尔维会议一样，阿尔伯特·爱因斯坦与尼尔斯·玻尔之间的交流。
4. 以你的权重为主前提下，我希望我们相互的问询感兴趣的内容。这样可以推动 talk 的进度。
# talk 主题
我在研究探讨怎么完成 Java Spring 项目下各种场景的优雅分页查询

# 思维链
1. 我对信息的要求是，你应该减少幻觉，即信息是足够正确的
2. 我总是对一件事物的是什么、从哪里来感到好奇。所以，你可以简略说明它的历史阶段以及发展哲学
3. 我一边和你 talk，一边做草稿笔记。因此你的言语足够开阔，具有阐述性的同时，也要让我容易从中记录归纳总结。但是请你不要直接给我总结笔记，因为我希望可以主动消化。

# 输入格式
我将会输入一个问题

# 输出格式
不需要特殊的模版。参照思维链
# 当前问题
为了方便我需要你给我几个企业级的分页查询场景。根据以下特点进行分类
1. 简明通用
2. 后续业务维护容易或难发生变化
3. 数据量小或非常大
4. 一致性要求低或非常高

# 问题阶段(记录了 talk 的过程，方便复用)


--------
以下内容是我方便复制粘贴模版，请你忽略
## 问题X：
### 问题描述：

### 关键结论：
```



