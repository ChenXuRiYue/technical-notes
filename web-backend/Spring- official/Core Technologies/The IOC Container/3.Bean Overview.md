# ğŸ“–Bean Overview

${\large {\color[RGB]{250, 157, 30}æ¦‚è¿°}} $

ä¸€ä¸ª Spring Ioc å®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–è€…å¤šä¸ª Beanã€‚Bean æ˜¯é€šè¿‡æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ã€‚

${\large {\color[RGB]{250, 157, 30}Bean \ ç»“æ„}} $

åœ¨å®¹å™¨æœ¬èº«ï¼Œè¿™äº› Bean è¢«å®šä¹‰ä¸º BeanDefinition å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä»¥ä¸‹å…ƒæ•°æ®

1. ä¸€ä¸ª**å…¨è·¯å¾„ç±»**åï¼šé€šå¸¸ï¼Œè¢«å®šä¹‰çš„Beançš„å®é™…å®ç°ç±»
2. Beançš„**è¡Œä¸ºé…ç½®å…ƒç´ **ï¼Œå®ƒè¯´æ˜äº†Beanåœ¨å®¹å™¨ä¸­çš„è¡Œä¸ºæ–¹å¼ï¼ˆscopeã€ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œç­‰ç­‰ï¼‰
3. **å¯¹å…¶ä»–Beançš„å¼•ç”¨**ï¼Œè¿™äº›Beanéœ€è¦åšå®ƒçš„å·¥ä½œã€‚è¿™äº›å¼•ç”¨ä¹Ÿè¢«ç§°ä¸ºåˆä½œè€…æˆ–ä¾èµ–
    [ğŸ’­ xml é…ç½®Beanæ–¹å¼ä¸‹ï¼Œæ˜¯å¦éœ€è¦è¦æè¿° Bean ä¾èµ–å…³ç³»ï¼Ÿ](#ğŸ’­ xml é…ç½®Beanæ–¹å¼ä¸‹ï¼Œæ˜¯å¦éœ€è¦è¦æè¿° Bean ä¾èµ–å…³ç³»ï¼Ÿ)
4. è¦åœ¨æ–°åˆ›å»ºçš„å¯¹è±¡ä¸­è®¾ç½®çš„å…¶ä»–é…ç½®è®¾ç½®â€”ä¾‹å¦‚ï¼Œpoolçš„å¤§å°é™åˆ¶æˆ–åœ¨ç®¡ç†è¿æ¥æ± çš„Beanä¸­ä½¿ç”¨çš„è¿æ¥æ•°

${\normalsize{\color[RGB]{253, 175, 14}å±æ€§åˆ—è¡¨}}$
| å±æ€§                     | è§£é‡Šâ€¦                                                        |
| :----------------------- | :----------------------------------------------------------- |
| Class                    | [å®ä¾‹åŒ– Bean](https://springdoc.cn/spring/core.html#beans-factory-class) |
| Name                     | [Bean å‘½å](https://springdoc.cn/spring/core.html#beans-beanname) |
| Scope                    | [Bean Scope](https://springdoc.cn/spring/core.html#beans-factory-scopes) |
| Constructor arguments    | [ä¾èµ–æ³¨å…¥](https://springdoc.cn/spring/core.html#beans-factory-collaborators) |
| Properties               | [ä¾èµ–æ³¨å…¥](https://springdoc.cn/spring/core.html#beans-factory-collaborators) |
| Autowiring mode          | [æ³¨å…¥åä½œè€…ï¼ˆAutowiring Collaboratorsï¼‰](https://springdoc.cn/spring/core.html#beans-factory-autowire) |
| Lazy initialization mode | [æ‡’åŠ è½½çš„Bean](https://springdoc.cn/spring/core.html#beans-factory-lazy-init) |
| Initialization method    | [åˆå§‹åŒ–å›è°ƒ](https://springdoc.cn/spring/core.html#beans-factory-lifecycle-initializingbean) |
| Destruction method       | [é”€æ¯å›è°ƒ](https://springdoc.cn/spring/core.html#beans-factory-lifecycle-disposablebean) |

## ğŸ“– Bean åˆ«å

${\large {\color[RGB]{250, 157, 30}Bean åˆ«å}} $

æ¯ä¸ªBeanéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡è¯†ç¬¦ï¼ˆidentifierï¼‰ã€‚è¿™äº›æ ‡è¯†ç¬¦åœ¨æ‰¿è½½Beançš„å®¹å™¨ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ä¸€ä¸ªBeané€šå¸¸åªæœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚ç„¶è€Œï¼Œå¦‚æœå®ƒéœ€è¦ä¸€ä¸ªä»¥ä¸Šçš„æ ‡è¯†ç¬¦ï¼Œå¤šä½™çš„æ ‡è¯†ç¬¦å¯ä»¥è¢«è§†ä¸ºåˆ«åã€‚

${\normalsize{\color[RGB]{253, 175, 14}XML \ ä¸­é…ç½®}}$
**å‘½åè§„èŒƒï¼š**å°å†™å­—æ¯å¼€å¤´ï¼Œé©¼å³°æ³•
**é»˜è®¤å‘½åï¼š**å–ç®€å•çš„ç±»åå¹¶å°†å…¶åˆå§‹å­—ç¬¦å˜æˆå°å†™ã€‚ç„¶è€Œï¼Œåœ¨ï¼ˆä¸å¯»å¸¸çš„ï¼‰ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå½“æœ‰ä¸€ä¸ªä»¥ä¸Šçš„å­—ç¬¦ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå­—ç¬¦éƒ½æ˜¯å¤§å†™æ—¶ï¼ŒåŸæ¥çš„å¤§å°å†™ä¼šè¢«ä¿ç•™ä¸‹æ¥

${\large {\color[RGB]{250, 157, 30}åœ¨ Bean Definition ä¹‹å¤–å¯¹Beanè¿›è¡Œåˆ«å}}$
XML ä¸­é€šè¿‡ \<alias> æ ‡ç­¾

${\large {\color[RGB]{250, 157, 30}Java é…ç½®}} $
è¯¦çœ‹ $Bean$ ç­‰æ³¨è§£ä½¿ç”¨

### ğŸ“– å®ä¾‹åŒ– Bean

- é€šå¸¸ï¼Œåœ¨å®¹å™¨æœ¬èº«é€šè¿‡åå°„å¼åœ°è°ƒç”¨æ„é€ å‡½æ•°ç›´æ¥åˆ›å»ºBeançš„æƒ…å†µä¸‹ï¼ŒæŒ‡å®šè¦æ„é€ çš„Beanç±»ï¼Œæœ‰ç‚¹ç›¸å½“äºJavaä»£ç ä¸­çš„ `new` æ“ä½œç¬¦ã€‚
- åœ¨ä¸å¤ªå¸¸è§çš„æƒ…å†µä¸‹ï¼Œå³å®¹å™¨åœ¨ä¸€ä¸ªç±»ä¸Šè°ƒç”¨ `static` å·¥å‚æ–¹æ³•æ¥åˆ›å»º bean æ—¶ï¼Œè¦æŒ‡å®šåŒ…å«è¢«è°ƒç”¨çš„ `static` å·¥å‚æ–¹æ³•çš„å®é™…ç±»ã€‚ä» `static` å·¥å‚æ–¹æ³•çš„è°ƒç”¨ä¸­è¿”å›çš„å¯¹è±¡ç±»å‹å¯èƒ½æ˜¯åŒä¸€ä¸ªç±»æˆ–å®Œå…¨æ˜¯å¦ä¸€ä¸ªç±»ã€‚

${\large {\color[RGB]{250, 157, 30}Bean ä½¿ç”¨æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–}} $

> å½“ä½ ç”¨æ„é€ å‡½æ•°çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªBeanæ—¶ï¼Œæ‰€æœ‰æ™®é€šçš„ç±»éƒ½å¯ä»¥è¢«Springä½¿ç”¨å¹¶ä¸ä¹‹å…¼å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¢«å¼€å‘çš„ç±»ä¸éœ€è¦å®ç°ä»»ä½•ç‰¹å®šçš„æ¥å£ï¼Œä¹Ÿä¸éœ€è¦ä»¥ç‰¹å®šçš„æ–¹å¼è¿›è¡Œç¼–ç ã€‚åªéœ€æŒ‡å®šBeanç±»å°±è¶³å¤Ÿäº†ã€‚ç„¶è€Œï¼Œæ ¹æ®ä½ å¯¹è¯¥ç‰¹å®šBeanä½¿ç”¨çš„IoCç±»å‹ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªé»˜è®¤ï¼ˆç©ºï¼‰æ„é€ å‡½æ•°ã€‚

è§£è¯»ï¼šä¸éœ€è¦å¼ºåˆ¶ bean å®ç°ä»»ä½•æ¥å£ã€‚

å­˜åœ¨å¤šç§ IOCï¼ˆæ§åˆ¶åè½¬çš„ç±»å‹ï¼‰ï¼Œä¸€äº›æ§åˆ¶ç±»å‹æ˜¯éœ€è¦ setter æ–¹æ³•å®ä¾‹åŒ–çš„ã€‚è¿™è¦æ±‚Bean ç±»å®ç°é»˜è®¤æ„é€ å‡½æ•°ã€‚å…ˆåˆ›å»ºååˆå§‹åŒ–ã€‚

ä¾‹å¦‚ä»¥ä¸‹é…ç½®æ˜¯é€šè¿‡ setter æ³¨å…¥ï¼š
```xml
<bean id="userService" class="com.example.UserService">
    <property name="name" value="Alice"/>
</bean>
```

${\normalsize {\color[RGB]{250, 157, 30}å‡ ç§IOC ç±»å‹}} $

| æ–¹å¼                       | è¯´æ˜                                       |
| -------------------------- | ------------------------------------------ |
| 1. åŸºäº XML çš„ setter æ³¨å…¥ | ä½¿ç”¨ `<property>`ï¼Œé€šè¿‡ setter æ–¹æ³•æ³¨å…¥    |
| 2. åŸºäº XML çš„æ„é€ å‡½æ•°æ³¨å…¥ | ä½¿ç”¨ `<constructor-arg>`ï¼Œé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ |
| 3. åŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…      | ä½¿ç”¨ `@Autowired`ã€`@Value` ç­‰             |
| 4. åŸºäº Java Config        | ä½¿ç”¨ `@Configuration` + `@Bean` æ–¹æ³•       |
| 5. ç»„ä»¶æ‰«æ + æ„é€ å‡½æ•°æ³¨å…¥ | `@Component` + æ„é€ å‡½æ•°å‚æ•°è‡ªåŠ¨æ³¨å…¥        |

${\large {\color[RGB]{250, 157, 30}Bean ç”¨é™æ€å·¥å‚æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–}} $

Spring ä¸­æä¾›äº†å®ç”¨é™æ€å·¥å‚æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–çš„æ–¹å¼ã€‚ä¸€èˆ¬æœ‰ä»¥ä¸‹ç”¨é€”ï¼š

1. åœ¨å†å²é—ç•™ä»£ç ä¸­è°ƒç”¨ static å·¥å‚ã€‚

ç¤ºä¾‹ï¼š

```xml
<bean id="clientService"
    class="examples.ClientService"
    factory-method="createInstance"/>
```

```java
public class ClientService {
    private static ClientService clientService = new ClientService();
    private ClientService() {}

    public static ClientService createInstance() {
        return clientService;
    }
}
```

${\large {\color[RGB]{250, 157, 30}Bean ç”¨å®ä¾‹å·¥å‚æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–}} $

Spring æä¾›äº†ç”¨å®ä¾‹å·¥å‚æ–¹æ³•è¿›è¡Œçš„å®ä¾‹åŒ–ä»å®¹å™¨ä¸­è°ƒç”¨ç°æœ‰ bean çš„éé™æ€æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ beanã€‚ä½¿ç”¨è¿™ç§æœºåˆ¶åº”è¯¥å…ˆå°† class å±æ€§ç•™ç©ºï¼Œï¼Œå¹¶åœ¨ `factory-bean` å±æ€§ä¸­æŒ‡å®šå½“å‰ï¼ˆæˆ–çˆ¶ä»£æˆ–ç¥–ä»£ï¼‰å®¹å™¨ä¸­çš„ä¸€ä¸ª Bean çš„åç§°ï¼Œè¯¥å®¹å™¨åŒ…å«è¦è¢«è°ƒç”¨æ¥åˆ›å»ºå¯¹è±¡çš„å®ä¾‹æ–¹æ³•ã€‚ç”¨ `factory-method` å±æ€§è®¾ç½®å·¥å‚æ–¹æ³•æœ¬èº«çš„åç§°ã€‚



Xml é…ç½®
```xml
<!-- the factory bean, which contains a method called createInstance() -->
<bean id="serviceLocator" class="examples.DefaultServiceLocator">
    <!-- inject any dependencies required by this locator bean -->
</bean>

<!-- the bean to be created via the factory bean -->
<bean id="clientService"
    factory-bean="serviceLocator"
    factory-method="createClientServiceInstance"/>

```

Bean ç±»ï¼š

```java
public class DefaultServiceLocator {

    private static ClientService clientService = new ClientServiceImpl();

    public ClientService createClientServiceInstance() {
        return clientService;
    }
}


```

å·¥å‚ç±»ï¼š

```java
public class DefaultServiceLocator {

    private static ClientService clientService = new ClientServiceImpl();

    private static AccountService accountService = new AccountServiceImpl();

    public ClientService createClientServiceInstance() {
        return clientService;
    }

    public AccountService createAccountServiceInstance() {
        return accountService;
    }
}
```

${\large {\color[RGB]{250, 157, 30}ç¡®å®š Bean çš„è¿è¡Œæ—¶ç±»å‹}} $

ç”±äºæ³¨å…¥æ–¹å¼ä¸­å·¥å‚æ–¹æ³•æ¨¡å¼åˆ›å»ºbeanã€‚ä»¥åŠAOPä»£ç†æŠ€æœ¯ä¸‹éœ€è¦åˆ›å»ºä»£ç†å¯¹è±¡ã€‚Bean çš„ç±»å‹ç¡®å®šæ˜¯å›°éš¾çš„ã€‚

å¯¹äºå¼€å‘æ¥è¯´ï¼šæ¨èä½¿ç”¨ BeanFactory.getType è°ƒç”¨ã€‚

```java
String beanName = "userService";
Class<?> beanType = applicationContext.getType(beanName);
System.out.println("The actual runtime type of '" + beanName + "' is: " + beanType.getName());
```

${\normalsize {\color[RGB]{250, 157, 30}getType æ–¹æ³•å®ç°}} $

1. å°è¯•ä» ConcurrentHashMap<String, Class<?>> typeCache ä¸­è¯»å–å‡ºç±»å‹ã€‚
2. ç°åœºè®¡ç®—ï¼šå¤šç§åˆ†ç±»è®¨è®ºã€‚ï¼ˆç»†èŠ‚åç»­çœ‹æºç  ==TODO==ï¼‰

## ğŸŒ³ å‘æ•£

#### ğŸ’­ xml é…ç½®Beanæ–¹å¼ä¸‹ï¼Œæ˜¯å¦éœ€è¦è¦æè¿° Bean ä¾èµ–å…³ç³»ï¼Ÿ

ğŸ“„ ç»å¤§å¤šæ•°æƒ…å†µä¸‹éœ€è¦æ‰‹åŠ¨åœ¨ XML ä¸­æ˜¾ç¤ºçš„ç”Ÿå‘½ä¾èµ–å…³ç³»ã€‚

**Service**

```java
public class UserService {
    private UserDAO userDAO;
    
    // setter æ–¹æ³•
    public void setUserDAO(UserDAO userDAO) {
        this.userDAO = userDAO;
    }
}
```

**Dao**

```java
public class UserDAO {
    // æ•°æ®è®¿é—®é€»è¾‘
}
```

**XML**

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- å®šä¹‰ UserDAO Bean -->
    <bean id="userDAO" class="com.example.UserDAO" />

    <!-- å®šä¹‰ UserService Beanï¼Œå¹¶æ‰‹åŠ¨æ³¨å…¥ userDAO -->
    <bean id="userService" class="com.example.UserService">
       <property name="userDAO" ref="userDAO" />
    </bean>

</beans>
```

å¦‚ä¸Šï¼Œéœ€è¦é€šè¿‡`<property name="userDAO" ref="userDAO" />` å®Œæˆä¾èµ–å…³ç³»çš„é…ç½®ã€‚

åœ¨è¿™é‡ŒçŒœæµ‹ XML è¢«æ·˜æ±°çš„ä¸»è¦åŸå› ä¹‹ä¸€å°±æ˜¯éœ€è¦é‡æ–°æè¿°ä¸€éä¾èµ–å…³ç³»ã€‚
