# ğŸ“Œ ç”¨ panicï¼å¤„ç†ä¸å¯æ¢å¤çš„é”™è¯¯

çªç„¶æœ‰ä¸€å¤©ï¼Œä»£ç å‡ºé—®é¢˜äº†ï¼Œè€Œä½ å¯¹æ­¤æŸæ‰‹æ— ç­–ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒRust æœ‰ `panic!`å®ã€‚

## ğŸ“„ ä½¿ç”¨ panic! 

### ğŸ”– panic çš„äº§ç”Ÿæœºåˆ¶

åœ¨å®è·µä¸­æœ‰ä¸¤ç§æ–¹æ³•é€ æˆ panicï¼šæ‰§è¡Œä¼šé€ æˆä»£ç  panic çš„æ“ä½œï¼ˆæ¯”å¦‚è®¿é—®è¶…è¿‡æ•°ç»„ç»“å°¾çš„å†…å®¹ï¼‰æˆ–è€…æ˜¾å¼è°ƒç”¨ `panic!` å®ã€‚è¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šä½¿ç¨‹åº panicã€‚é€šå¸¸æƒ…å†µä¸‹è¿™äº› panic ä¼šæ‰“å°å‡ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå±•å¼€å¹¶æ¸…ç†æ ˆæ•°æ®ï¼Œç„¶åé€€å‡ºã€‚

### ğŸ”– å“åº” panic çš„æ ˆå±•å¼€æˆ–ç»ˆæ­¢

å½“å‡ºç° panic æ—¶ï¼Œç¨‹åºé»˜è®¤ä¼šå¼€å§‹ **å±•å¼€**ï¼ˆ*unwinding*ï¼‰ï¼Œè¿™æ„å‘³ç€ Rust ä¼šå›æº¯æ ˆå¹¶æ¸…ç†å®ƒé‡åˆ°çš„æ¯ä¸€ä¸ªå‡½æ•°çš„æ•°æ®ï¼Œä¸è¿‡è¿™ä¸ªå›æº¯å¹¶æ¸…ç†çš„è¿‡ç¨‹æœ‰å¾ˆå¤šå·¥ä½œã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯ç›´æ¥ **ç»ˆæ­¢**ï¼ˆ*abort*ï¼‰ï¼Œè¿™ä¼šä¸æ¸…ç†æ•°æ®å°±é€€å‡ºç¨‹åºã€‚

é‚£ä¹ˆç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜éœ€è¦ç”±æ“ä½œç³»ç»Ÿæ¥æ¸…ç†ã€‚å¦‚æœä½ éœ€è¦é¡¹ç›®çš„æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶è¶Šå°è¶Šå¥½ï¼Œpanic æ—¶é€šè¿‡åœ¨ *Cargo.toml* çš„ `[profile]` éƒ¨åˆ†å¢åŠ  `panic = 'abort'`ï¼Œå¯ä»¥ç”±å±•å¼€åˆ‡æ¢ä¸ºç»ˆæ­¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦åœ¨ release æ¨¡å¼ä¸­ panic æ—¶ç›´æ¥ç»ˆæ­¢ï¼Œå¯æ·»åŠ ï¼š

```toml
[profile.release]
panic = 'abort'
```



### ğŸ”– ç®€å•ç¤ºä¾‹

```rust
fn main() {
    panic!("crash and burn");
}
```

è¾“å‡ºï¼š

```shell
$ cargo run
   Compiling panic v0.1.0 (file:///projects/panic)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.25s
     Running `target/debug/panic`

thread 'main' panicked at src/main.rs:2:5:
crash and burn
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

```

1. æœ€åä¸¤è¡ŒåŒ…å« `panic!` è°ƒç”¨é€ æˆçš„é”™è¯¯ä¿¡æ¯
2. ç¬¬ä¸€è¡Œæ˜¾ç¤ºäº† panic æä¾›çš„ä¿¡æ¯å¹¶æŒ‡æ˜äº†æºç ä¸­ panic å‡ºç°çš„ä½ç½®ï¼š*src/main.rs:2:5* è¡¨æ˜è¿™æ˜¯ *src/main.rs* æ–‡ä»¶çš„ç¬¬äºŒè¡Œç¬¬äº”ä¸ªå­—ç¬¦ã€‚

## ğŸ“„  ä½¿ç”¨ panic! çš„ backtrace

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `panic!` è¢«è°ƒç”¨çš„å‡½æ•°çš„ **backtrace** æ¥å¯»æ‰¾ä»£ç ä¸­å‡ºé—®é¢˜çš„åœ°æ–¹ã€‚

ç¤ºä¾‹
```rust
fn main() {
    let v = vec![1, 2, 3];

    v[99];
}
```

```
$ cargo run
   Compiling panic v0.1.0 (file:///projects/panic)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.27s
     Running `target/debug/panic`

thread 'main' panicked at src/main.rs:4:6:
index out of bounds: the len is 3 but the index is 99
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

```

`note:` å‘Šè¯‰æˆ‘ä»¬å¯ä»¥è®¾ç½® `RUST_BACKTRACE` ç¯å¢ƒå˜é‡æ¥å¾—åˆ°ä¸€ä¸ª backtraceã€‚*backtrace* æ˜¯ä¸€ä¸ªæ‰§è¡Œåˆ°ç›®å‰ä½ç½®æ‰€æœ‰è¢«è°ƒç”¨çš„å‡½æ•°çš„åˆ—è¡¨ã€‚Rust çš„ backtrace è·Ÿå…¶ä»–è¯­è¨€ä¸­çš„ä¸€æ ·ï¼šé˜…è¯» backtrace çš„å…³é”®æ˜¯ä»å¤´å¼€å§‹è¯»ç›´åˆ°å‘ç°ä½ ç¼–å†™çš„æ–‡ä»¶ã€‚è¿™å°±æ˜¯é—®é¢˜çš„å‘æºåœ°ã€‚è¿™ä¸€è¡Œå¾€ä¸Šæ˜¯ä½ çš„ä»£ç æ‰€è°ƒç”¨çš„ä»£ç ï¼›å¾€ä¸‹åˆ™æ˜¯è°ƒç”¨ä½ çš„ä»£ç çš„ä»£ç ã€‚è¿™äº›è¡Œå¯èƒ½åŒ…å«æ ¸å¿ƒ Rust ä»£ç ï¼Œæ ‡å‡†åº“ä»£ç æˆ–ç”¨åˆ°çš„ crate ä»£ç ã€‚è®©æˆ‘ä»¬å°† `RUST_BACKTRACE` ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºä»»ä½•ä¸æ˜¯ `0` çš„å€¼æ¥è·å– backtrace çœ‹çœ‹ã€‚ç¤ºä¾‹ 9-2 å±•ç¤ºäº†ä¸ä½ çœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š

```rust
$ RUST_BACKTRACE=1 cargo run
thread 'main' panicked at src/main.rs:4:6:
index out of bounds: the len is 3 but the index is 99
stack backtrace:
   0: rust_begin_unwind
             at /rustc/4d91de4e48198da2e33413efdcd9cd2cc0c46688/library/std/src/panicking.rs:692:5
   1: core::panicking::panic_fmt
             at /rustc/4d91de4e48198da2e33413efdcd9cd2cc0c46688/library/core/src/panicking.rs:75:14
   2: core::panicking::panic_bounds_check
             at /rustc/4d91de4e48198da2e33413efdcd9cd2cc0c46688/library/core/src/panicking.rs:273:5
   3: <usize as core::slice::index::SliceIndex<[T]>>::index
             at file:///home/.rustup/toolchains/1.85/lib/rustlib/src/rust/library/core/src/slice/index.rs:274:10
   4: core::slice::index::<impl core::ops::index::Index<I> for [T]>::index
             at file:///home/.rustup/toolchains/1.85/lib/rustlib/src/rust/library/core/src/slice/index.rs:16:9
   5: <alloc::vec::Vec<T,A> as core::ops::index::Index<I>>::index
             at file:///home/.rustup/toolchains/1.85/lib/rustlib/src/rust/library/alloc/src/vec/mod.rs:3361:9
   6: panic::main
             at ./src/main.rs:4:6
   7: core::ops::function::FnOnce::call_once
             at file:///home/.rustup/toolchains/1.85/lib/rustlib/src/rust/library/core/src/ops/function.rs:250:5
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.

```

## ğŸŒ³ ç”Ÿé•¿æ€è€ƒ

å¯¹å‘æ•£çš„è‡ªç”±æ•æ‰ã€ç²¾ç¡®åŒ–

## ğŸ’­ åå¤ç»Šè„š

è®°å½•å›é¡¾ã€ä½¿ç”¨æ–‡æ¡£æ—¶ï¼Œé‡åˆ°çš„å›°æƒ‘



## ğŸ—ºï¸ ä¿®è®¢è®°å½•

é‡è¦ä¿®è®¢è®°å½•

## ğŸ› ï¸ å®è·µç»å†

è®°å½•å®è·µç»å†ï¼š demo + å·¥ä½œç»å† + ç¬¬ä¸‰æ–¹ä¼˜ç§€ç»éªŒåæ€



## âš™ï¸ prompt

æ¢ç©¶è¯¥æ–‡æ¡£æ¨¡å—è¿‡ç¨‹ä¸­çš„ prompt è®°å½•
æ¨¡ç‰ˆå¦‚ä¸‹ï¼š

```markdown
# èƒŒæ™¯
æˆ‘æ˜¯ä¸€åè¿½æ±‚æ•ˆç‡çš„å­¦ä¹ è€…ã€‚æˆ‘ä»äº‹äºJavaåç«¯å¼€å‘å·¥ç¨‹å¸ˆçš„å·¥ä½œã€‚
æˆ‘è®¤ä¸ºå­¦ä¹ æœ¬è´¨ä¸Šå°±æ˜¯ å¤§é‡æ­£ç¡®ä¿¡æ¯çš„æ¶ˆåŒ– + å…³é”®ç»“è®ºçš„æ„Ÿå— + è‡ªç”±çš„å‘æ•£ã€‚
ä¾æ‰˜è¿™æ ·çš„æ€æƒ³ï¼Œæˆ‘å¸Œæœ›å’Œä½ æ¥è¿›è¡Œä¸€åœºtalkã€‚

æˆ‘ä»¬çš„ talk åŸºäºä»¥ä¸‹åŸåˆ™
1. ä½ æ˜¯ è¯¥talk ä¸»é¢˜ä¸‹çš„ä¸“å®¶
2. æˆ‘æ˜¯ä¸€ååœ¨å…¶ä»–é¢†åŸŸå…·æœ‰é€šç”¨æ€§æŠ€èƒ½çš„å·¥ç¨‹å¸ˆï¼Œå¦‚ Javaã€ä¼ ç»Ÿç®—æ³•ã€åç«¯å·¥ç¨‹ã€C++ è¯­æ³•ã€Go è¯­æ³•ç­‰ã€‚æ‹¥æœ‰ä¸€å®šè®¡ç®—æœºåŸºç¡€çš„çŸ¥è¯†ã€‚
3. æˆ‘ä»¬æ˜¯ä¸åŒé¢†åŸŸçš„æ“…é•¿è€…ï¼Œè¿™æ˜¯ä¸€åœºåœ†æ¡Œä¼šè®®å¼çš„talkã€‚å°±å’Œç´¢å°”ç»´ä¼šè®®ä¸€æ ·ï¼Œé˜¿å°”ä¼¯ç‰¹Â·çˆ±å› æ–¯å¦ä¸å°¼å°”æ–¯Â·ç»å°”ä¹‹é—´çš„äº¤æµã€‚
4. ä»¥ä½ çš„æƒé‡ä¸ºä¸»å‰æä¸‹ï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬ç›¸äº’çš„é—®è¯¢æ„Ÿå…´è¶£çš„å†…å®¹ã€‚è¿™æ ·å¯ä»¥æ¨åŠ¨ talk çš„è¿›åº¦ã€‚
# talk ä¸»é¢˜


# æ€ç»´é“¾
1. æˆ‘å¯¹ä¿¡æ¯çš„è¦æ±‚æ˜¯ï¼Œä½ åº”è¯¥å‡å°‘å¹»è§‰ï¼Œå³ä¿¡æ¯æ˜¯è¶³å¤Ÿæ­£ç¡®çš„
2. æˆ‘æ€»æ˜¯å¯¹ä¸€ä»¶äº‹ç‰©çš„æ˜¯ä»€ä¹ˆã€ä»å“ªé‡Œæ¥æ„Ÿåˆ°å¥½å¥‡ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥ç®€ç•¥è¯´æ˜å®ƒçš„å†å²é˜¶æ®µä»¥åŠå‘å±•å“²å­¦
3. æˆ‘ä¸€è¾¹å’Œä½  talkï¼Œä¸€è¾¹åšè‰ç¨¿ç¬”è®°ã€‚å› æ­¤ä½ çš„è¨€è¯­è¶³å¤Ÿå¼€é˜”ï¼Œå…·æœ‰é˜è¿°æ€§çš„åŒæ—¶ï¼Œä¹Ÿè¦è®©æˆ‘å®¹æ˜“ä»ä¸­è®°å½•å½’çº³æ€»ç»“ã€‚ä½†æ˜¯è¯·ä½ ä¸è¦ç›´æ¥ç»™æˆ‘æ€»ç»“ç¬”è®°ï¼Œå› ä¸ºæˆ‘å¸Œæœ›å¯ä»¥ä¸»åŠ¨æ¶ˆåŒ–ã€‚

# è¾“å…¥æ ¼å¼
æˆ‘å°†ä¼šè¾“å…¥ä¸€ä¸ªé—®é¢˜

# è¾“å‡ºæ ¼å¼
ä¸éœ€è¦ç‰¹æ®Šçš„æ¨¡ç‰ˆã€‚å‚ç…§æ€ç»´é“¾
# å½“å‰é—®é¢˜


# é—®é¢˜é˜¶æ®µ(è®°å½•äº† talk çš„è¿‡ç¨‹ï¼Œæ–¹ä¾¿å¤ç”¨)


--------
ä»¥ä¸‹å†…å®¹æ˜¯æˆ‘æ–¹ä¾¿å¤åˆ¶ç²˜è´´æ¨¡ç‰ˆï¼Œè¯·ä½ å¿½ç•¥
## é—®é¢˜Xï¼š
1.1 é—®é¢˜æè¿°ï¼š

1.2 å…³é”®ç»“è®ºï¼š
```



